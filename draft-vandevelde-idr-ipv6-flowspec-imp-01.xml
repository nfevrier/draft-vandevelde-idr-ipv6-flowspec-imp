<?xml version="1.0"?>
<!DOCTYPE rfc SYSTEM "rfc2629.dtd" [
<!-- One method to get references from the online citation libraries.
     There has to be one entity for each item to be referenced. 
     An alternate method (rfc include) is described in the references. -->
<!ENTITY I-D.draft-ietf-idr-flow-spec-v6 SYSTEM "http://xml.resource.org/public/rfc/bibxml3/reference.I-D.draft-ietf-idr-flow-spec-v6-06.xml">
]>
<?rfc comments="yes"?>
<?rfc compact="no"?>
<?rfc inline="yes"?>
<?rfc sortrefs="yes"?>
<?rfc subcompact="no"?>
<?rfc symrefs="yes"?>
<?rfc toc="yes"?>
<?rfc tocdepth="5"?>
<?rfc tocindent="yes"?>
<?rfc tocompact="yes"?>

<rfc category="info" docName="draft-vandevelde-idr-ipv6-flowspec-imp-01"
     ipr="trust200902">

  <front>

    <title abbrev="">Dissemination of Flow Specification Rules for IPv6 Implementation Report</title>

    <author fullname="Gunter Van de Velde" initials="G."
            surname="Van de Velde">
      <organization>Alcatel-Lucent</organization>
      <address>
        <postal>
          <street>Copernicuslaan 50</street>
          <city>Antwerpen</city>
          <country>Belgium</country>
          <code>2018</code>
        </postal>
        <phone></phone>
        <email>gunter.van_de_velde@alcatel-lucent.com</email>
      </address>
    </author>

    <author fullname="Wim Henderickx" initials="W."
            surname="Henderickx">
      <organization>Alcatel-Lucent</organization>
      <address>
        <postal>
          <street></street>
          <city></city>
          <country></country>
          <code></code>
        </postal>
        <phone></phone>
        <email>wim.henderickx@alcatel-lucent.be</email>
      </address>
    </author>
	
    <author fullname="Nicolas Fevrier" initials="N."
            surname="Fevrier">
      <organization>Cisco Systems</organization>
      <address>
        <postal>
          <street>11 Rue Camille Desmoulins</street>
          <city>Issy-les-Koulineaux</city>
          <country>France</country>
          <code>92130</code>
        </postal>
        <phone></phone>
        <email>nifevrie@cisco.com</email>
      </address>
    </author>


    <author fullname="Andy Karch" initials="A."
            surname="Karch">
      <organization>Cisco Systems</organization>
      <address>
        <postal>
          <street>170 W. Tasman Drive</street>
          <city>San Jose, CA 95124</city>
          <country>USA</country>
          <code>95134</code>
        </postal>
        <phone></phone>
        <email>akarch@cisco.com</email>
      </address>
    </author>

<author fullname="Ashutosh Grewal" initials="A."
            surname="Grewal">
      <organization>Juniper Networks</organization>
      <address>
        <postal>
          <street>1133 Innovation Way</street>
          <city>Sunnyvale, CA 94089</city>
          <country>USA</country>
          <code>94089</code>
        </postal>
        <phone></phone>
        <email>agrewal@juniper.net</email>
      </address>
    </author>

    <date month="June" year="2015" />

    <area>Routing</area>

    <workgroup>IDR</workgroup>

    <abstract>
	
     <t>This document is an implementation report for the BGP Flow 
	 Specification Rules for IPv6 as defined in <xref target="I-D.ietf-idr-flow-spec-v6"/>.  
	 The respondents are experts with the implementations they reported on, 
	 and their responses are considered authoritative for the implementations 
	 for which their responses represent. 
     </t>

    </abstract>

  </front>

  <middle>

    <section anchor="intro" title="Introduction">
         <t>In order to share Flow Specification Rules for IPv6 using the BGP
		 routing protocol a new BGP Network Layer Reachability Information 
		 (NLRI) encoding format is required.
		 </t>
		 
		 <t>This document provides an implementation report for the BGP Dissemination 
		 of Flow Specification Rules for IPv6 NLRI Format as defined in 
		 <xref target="I-D.ietf-idr-flow-spec-v6"/>.
		 </t>
		 
		 <t>The editors did not verify the accuracy of the information provided
		 by respondents or by any alternative means.  The respondents are 
		 experts with the implementations they reported on, and their responses
		 are considered authoritative for the implementations for which their
		 responses represent.  
         </t>

     </section>

     <section title="Requirements Language">
       <t>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL
	 NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and
	 "OPTIONAL" are to be interpreted as described in
	 <xref target="RFC2119"/> only when they appear in all upper
	 case.  They may also appear in lower or mixed case as English
	 words, without any normative meaning.</t>
     </section>

     <section title="Implementation Forms">

         <t>Contact and implementation information for person filling out this
		 form:
         </t>

         <figure>
             <artwork><![CDATA[
         Cisco
             Name: Nicolas Fevrier
             Email: nifevrie@cisco.com
             Vendor: Cisco Systems, Inc.
             Release: IOS-XR
             Protocol Role: Sender, Receiver

         Alcatel-Lucent
             Name: Wim Henderickx
             Email: wim.henderickx@alcatel-lucent.com
             Vendor: Alcatel-Lucent, Inc.
             Release: R12R4
             Protocol Role: Sender, Receiver
             ]]></artwork>
      </figure>

     </section>


     <section title="NLRI and Extended Community subtypes">
         
		 <t>Does the implementation support the Network Layer Reachability (NLRI) subtypes as 
		 described in Section 3 and 4 of <xref target="I-D.ietf-idr-flow-spec-v6"/>.
		 </t>
	 
	     <t><list style="symbols">
             <t>N1:  Type 1 - Destination IPv6 Prefix</t>
		     <t>N2:  Type 2 - Source IPv6 Prefix</t>
		     <t>N3:  Type 3 - Next Header</t>
		     <t>N4: Type 4 - Port</t>
		     <t>N5: Type 5 - Destination port</t>
		     <t>N6: Type 6 - Source port</t>
		     <t>N7: Type 7 - ICMP type</t>
		     <t>N8: Type 8 - ICMP code</t>
		     <t>N9: Type 9 - TCP flags</t>
		     <t>N10: Type 10 - Packet length</t>
		     <t>N11: Type 11 - DSCP (Diffserv Code Point)</t>
		     <t>N12: Type 12 - Fragment</t>
		     <t>N13: Type 13 - Flow Label</t>
			 <t>E1:  Extended Community - traffic-rate</t>
			 <t>E2:  Extended Community - traffic-action</t>
			 <t>E3:  Extended Community - redirect</t>
			 <t>E4:  Extended Community - traffic-marking</t>
         </list> </t>
		
		
     <figure>
         <artwork>

                     +--------+--------+-------+---------+
                     |        | Cisco  |  ALU  | Juniper |
                     +--------+--------+-------+---------+
                     | Rcv.N1 |   YES  |  YES  |   YES   |
                     | Snd.N1 |   YES  |  YES  |   YES   |
                     | Rcv.N2 |   YES  |  YES  |   YES   |
                     | Snd.N2 |   YES  |  YES  |   YES   |
                     | Rcv.N3 |   YES  |  YES  |   YES   |
                     | Snd.N3 |   YES  |  YES  |   YES   |
                     | Rcv.N4 |   YES  |  YES  |   YES   |
                     | Snd.N4 |   YES  |  YES  |   YES   |
                     | Rcv.N5 |   YES  |  YES  |   YES   |
                     | Snd.N5 |   YES  |  YES  |   YES   |
                     | Rcv.N6 |   YES  |  YES  |   YES   |
                     | Snd.N6 |   YES  |  YES  |   YES   |
                     | Rcv.N7 |   YES  |  YES  |   YES   |
                     | Snd.N7 |   YES  |  YES  |   YES   |
                     | Rcv.N8 |   YES  |  YES  |   YES   |
                     | Snd.N8 |   YES  |  YES  |   YES   |
                     | Rcv.N9 |   YES  |  YES  |   YES   |
                     | Snd.N9 |   YES  |  YES  |   YES   |
                     | Rcv.N10|   YES  |  YES  |   YES   |
                     | Snd.N10|   YES  |  YES  |   YES   |
                     | Rcv.N11|   YES  |  YES  |   YES   |
                     | Snd.N11|   YES  |  YES  |   YES   |
                     | Rcv.N12|   YES  |  YES  |   YES   |
                     | Snd.N12|   YES  |  YES  |   YES   |
                     | Rcv.N13|   YES  |  YES  |   YES   |
                     | Snd.N13|   YES  |  YES  |   YES   |
                     | Rcv.E1 |   YES  |  YES  |   YES   |
                     | Snd.E1 |   YES  |  YES  |   YES   |
                     | Rcv.E2 |   YES  |  YES  |   YES   |
                     | Snd.E2 |   YES  |  YES  |   YES   |
                     | Rcv.E3 |   YES  |  YES  |   YES   |
                     | Snd.E3 |   YES  |  YES  |   YES   |
                     | Rcv.E4 |   YES  |  YES  |   YES   |
                     | Snd.E4 |   YES  |  YES  |   YES   |
                     +--------+--------+-------+---------+
	  
         </artwork>
     </figure>
	 
	     <t>Yes<list style="symbols">
             <t>Rcv: BGP speaker can receive the information into the BGP process</t>
		     <t>Snd: BGP speaker can relay the information from the BGP process</t>
         </list> </t>	 

		 <t>No<list style="symbols">
             <t>Rcv: BGP speaker can not receive the information into the BGP process</t>
		     <t>Snd: BGP speaker can not relay the information from the BGP process</t>
         </list> </t>	 
	 
     </section>

   <section title="Interoperable Implementations">

         <t>Summary of executed Interop tests between different implementations
		 </t>
		 
         <section title="Cisco Systems - Alcatel-Lucent">
             <t>This Interop test was between a Cisco router and a 
			 Alcatel-Lucent Router. Between the two BGP devices an iBGP 
			 session is established. 
			 </t>

			 <t>The following IPv6 Flow Specification NLRI is constructed 
			 using the Cisco router as IPv6 Flow Specification controller:
	         </t>

	     <figure>
             <artwork>
            !
            class-map type traffic match-all InteropMatchList
             match destination-address ipv6 2001:2::3/128
             match source-address ipv6 2002:2::3/128
             match destination-port 1-5 7-11 13-18 20-25 27-31
             match source-port 33-37 39-43 45-50 53-58 60-65
             match ipv6 icmp-type 35
             match ipv6 icmp-code 55
             match packet length 120-130 135-140 145-160 165-200 205-225
             match dscp 1-10 11-20 22-30 32-40 52-60
             match tcp-flag 240 any
             match protocol 6-71 73-80 85-90 95-105 110-115
             match fragment-type  first-fragment
             end-class-map
             !
            !
            policy-map type pbr InteropPolicy
             class type traffic InteropMatchList
              police rate 200 bps
             !
             redirect nexthop 2001::1
             set dscp 45
            !
            class type traffic class-default
           !
           end-policy-map
          !
         flowspec
          address-family ipv6
           service-policy type pbr InteropPolicy
          !
         !
             </artwork>
         </figure>
			 
         <t>This results with the following Flow Specification Extended
		 communities and IPv6 Flow Specification NLRI:
		 </t>

         <figure>
             <artwork>
             	AFI: IPv6
             NLRI (Hex dump) :
             		0x0180002001000200000000000000000000000302800020020002000000000000
             		0000000000030303064547034945500355455a035f4569036ec573050301450503
             		07450b030d451203144519031bc51f06032145250327452b032d45320335453a03
             		3cc5410781230881370980f00a037845820387458c039145a003a545c803cdc5e1
             		0b0301450a030b45140316451e032045280334c53c0c8104
             Actions       :Traffic-rate: 200 bps DSCP: 45 
             		Nexthop: 2001::1  (policy.1.InteropPolicy.InteropMatchList)
			 </artwork>
         </figure>
		 
		 <t>The above IPv6 Flow Specification rule is correctly received by 
		 the Alcatel-Lucent BGP speaker and is reflected as follows on the 
		 device:
		 </t>
 
         <figure>
             <artwork><![CDATA[ 
*A:PE26>show>router>bgp# routes flow-ipv6 
===============================================================================
 BGP Router ID:195.207.5.200    AS:65117       Local AS:65117      
===============================================================================
 Legend -
 Status codes  : u - used, s - suppressed, h - history, d - decayed, * - valid
                 l - leaked, x - stale, > - best, b - backup
 Origin codes  : i - IGP, e - EGP, ? - incomplete

===============================================================================
BGP FLOW IPV6 Routes
===============================================================================
Flag  Network             Nexthop                 LocalPref       MED
      As-Path                                                     
-------------------------------------------------------------------------------
u*>i  --                  2001::1                 100             None
      No As-Path
                                                                  
      Community Action:  ext:800:0
      Community Action:  rate-limit: 65117:1103626240
      Community Action:  mark-dscp: 45
      NLRI Subcomponents:                                         
      Dest Pref : 2001:2::3/128 offset 0
      Src Pref  : 2002:2::3/128 offset 0
      Ip Proto  : [ >= 6 ] and [ <= 71 ] or [ >= 73 ] and [ <= 80 ] or [ >= 
      Dest Port : [ >= 1 ] and [ <= 5 ] or [ >= 7 ] and [ <= 11 ] or [ >= 13
      Src Port  : [ >= 33 ] and [ <= 37 ] or [ >= 39 ] and [ <= 43 ] or [ >=
      ICMP Type : [ == 35 ]
      ICMP Code : [ == 55 ]
      TCP Flags : [ 240 ]
      TCP Flags : [ 240 ]
      DSCP      : [ >= 1 ] and [ <= 10 ] or [ >= 11 ] and [ <= 20 ] or [ >= 
      Frag      : [ == 4 ]
-------------------------------------------------------------------------------
Routes : 1
===============================================================================
 			 ]]></artwork>
         </figure>
		 </section>
   
            <section title="Cisco Systems - Juniper Networks">
             <t>This Interop test was between a Cisco router and a 
			 Juniper Router. Between the two BGP devices an iBGP session
			 is established. 
			 </t>

			 <t>The following IPv6 Flow Specification NLRI is constructed 
			 using the Cisco router as IPv6 Flow Specification controller:
	         </t>

	     <figure>
             <artwork>
            !
            class-map type traffic match-all InteropMatchList
             match destination-address ipv6 2001:2::3/128
             match source-address ipv6 2002:2::3/128
             match destination-port 1-5 7-11 13-18 20-25 27-31
             match source-port 33-37 39-43 45-50 53-58 60-65
             match ipv6 icmp-type 35
             match ipv6 icmp-code 55
             match packet length 120-130 135-140 145-160 165-200 205-225
             match dscp 1-10 11-20 22-30 32-40 52-60
             match tcp-flag 240 any
             match protocol 6-71 73-80 85-90 95-105 110-115
             match fragment-type  first-fragment
             end-class-map
             !
            !
            policy-map type pbr InteropPolicy
             class type traffic InteropMatchList
              police rate 200 bps
             !
             redirect nexthop 2001::1
             set dscp 45
            !
            class type traffic class-default
           !
           end-policy-map
          !
         flowspec
          address-family ipv6
           service-policy type pbr InteropPolicy
          !
         !
             </artwork>
         </figure>
			 
         <t>This results with the following Flow Specification Extended
		 communities and IPv6 Flow Specification NLRI:
		 </t>

         <figure>
             <artwork>
             	AFI: IPv6
             NLRI (Hex dump) :
             		0x0180002001000200000000000000000000000302800020020002000000000000
             		0000000000030303064547034945500355455a035f4569036ec573050301450503
             		07450b030d451203144519031bc51f06032145250327452b032d45320335453a03
             		3cc5410781230881370980f00a037845820387458c039145a003a545c803cdc5e1
             		0b0301450a030b45140316451e032045280334c53c0c8104
             Actions       :Traffic-rate: 200 bps DSCP: 45 
             		Nexthop: 2001::1  (policy.1.InteropPolicy.InteropMatchList)
			 </artwork>
         </figure>
		 
		 <t>The above IPv6 Flow Specification rule is correctly received by 
		 the Juniper BGP speaker and is reflected as follows on the 
		 device:
		 </t>
 
         <figure>
             <artwork><![CDATA[ 

root@sdn-st-mx480-b> show route table inet6flow.0 extensive

inet6flow.0: 2 destinations, 2 routes (2 active, 0 holddown, 0 hidden)
2001:2::3/128,2002:2::3/128,proto>=6&<=71,>=73&<=80,>=85&<=90,>=95&<=105,>=110&<=115,
dstport>=1&<=5,>=7&<=11,>=13&<=18,>=20&<=25,>=27&<=31,
srcport>=33&<=37,>=39&<=43,>=45&<=50,>=53&<=58,>=60&<=65,icmp6-type=35,icmp6-code=55,
tcp-flag:f0,len>=120&<=130,>=135&<=140,>=145&<=160,>=165&<=200,>=205&<=225,
dscp>=1&<=10,>=11&<=20,>=22&<=30,>=32&<=40,>=52&<=60,frag=04/term:N/A 
(1 entry, 0 announced)
        *BGP    Preference: 170/-101
                Next hop type: Fictitious, Next hop index: 0
                Address: 0x95542a4
                Next-hop reference count: 2
                State: <Active Int Ext>
                Local AS: 65117 Peer AS: 65117
                Age: 1:58
                Validation State: unverified
                Task: BGP_65117.10.0.0.2
                AS path: I
                Communities: unknown iana 800 traffic-rate:65117:25 traffic-marking:45
                Accepted
                Localpref: 100
                Router ID: 10.0.0.2

Jun 12 15:37:57.990156 BGP RECV 10.0.0.2+179 -> 10.0.0.1+58360
Jun 12 15:37:57.990202 BGP RECV message type 2 (Update) length 245
Jun 12 15:37:57.990228 BGP RECV Update PDU length 245
Jun 12 15:37:57.990260 BGP RECV flags 0x90 code MP_reach(14): AFI/SAFI 2/133
Jun 12 15:37:57.990287 -akg- nhlen from packet : 16
Jun 12 15:37:57.990316 BGP RECV         nhop zero-len len 16
Jun 12 15:37:57.990388 BGP RECV         2001:2::3/128,2002:2::3/128,proto>=6&<=71,>=73&<=80,
>=85&<=90,>=95&<=105,>=110&<=115,dstport>=1&<=5,>=7&<=11,>=13&<=18,>=20&<=25,>=27&<=31,
srcport>=33&<=37,>=39&<=43,>=45&<=50,>=53&<=58,>=60&<=65,icmp6-type=35,icmp6-code=55,
tcp-flag:f0,len>=120&<=130,>=135&<=140,>=145&<=160,>=165&<=200,>=205&<=225,
dscp>=1&<=10,>=11&<=20,>=22&<=30,>=32&<=40,>=52&<=60,frag=04/1240
Jun 12 15:37:57.990418 BGP RECV flags 0x40 code Origin(1): IGP
Jun 12 15:37:57.990446 BGP RECV flags 0x40 code ASPath(2) length 0: <null>
Jun 12 15:37:57.990471 BGP RECV flags 0x40 code LocalPref(5): 100
Jun 12 15:37:57.990517 BGP RECV flags 0xc0 code Extended Communities(16): <snip>

 			 ]]></artwork>
         </figure>
		 </section>
   
               <section title="Juniper Networks - Cisco Systems">
             <t>This Interop test was between a Juniper router and a 
			 Cisco Router. Between the two BGP devices an iBGP session
			 is established. 
			 </t>

			 <t>The following IPv6 Flow Specification NLRI is constructed 
			 using the Juniper router as IPv6 Flow Specification controller:
	         </t>

	     <figure>
             <artwork>
            !
root@sdn-st-mx480-b# show routing-options
rib inet6.0 {
    flow {
        route flowroute {
            match {
                destination abcd::1/128;
                source abcd::2/128;
                protocol [ 6-71 73-80 85-90 95-105 110-115 ];
                destination-port [ 1-5 7-11 13-18 20-25 27-31 ];
                source-port [ 33-37 39-43 45-50 53-58 60-65 ];
                icmp6-type 35;
                icmp6-code 55;
                tcp-flags 240;
                packet-length [ 120-130 135-140 145-160 165-200 205-225 ];
                dscp [ 1-10 11-20 22-30 32-40 52-60 ];
                fragment first-fragment;
                flow-label [ ( 22 || 77 ) 11 33 89 ];
            }
            then {
                rate-limit 9600;
                mark 45;
            }
        }
    }
}
             </artwork>
         </figure>
			 

		 <t>The above IPv6 Flow Specification rule is correctly received by 
		 the Cisco BGP speaker and is reflected as follows on the 
		 device:
		 </t>
 
         <figure>
             <artwork><![CDATA[ 


RP/0/RSP0/CPU0:ASR9k-FlowSpec-Interop#sh flowspec ipv6 detail

AFI: IPv6
 Flow           :Dest:abcd::1/0-128,Source:abcd::2/0-128,
 NH:>=6&<=71|>=73&<=80|>=85&<=90|>=95&<=105|>=110&<=115,
 DPort:>=1&<=5|>=7&<=11|>=13&<=18|>=20&<=25|>=27&<=31,
 SPort:>=33&<=37|>=39&<=43|>=45&<=50|>=53&<=58|>=60&<=65,ICMPType:=35,ICMPCode:=55,
 TCPFlags:~0xf0,Length:>=120&<=130|>=135&<=140|>=145&<=160|>=165&<=200|>=205&<=225,
 DSCP:>=1&<=10|>=11&<=20|>=22&<=30|>=32&<=40|>=52&<=60,Frag:~FF,
 FlowLabel:=22|=77|=11|=33|=89
  Actions       :Traffic-rate: 9600 bps DSCP: 45  (bgp.1)
  Statistics                        (packets/bytes)
   Matched             :                   0/0
   Dropped             :                   0/0   

RP/0/RSP0/CPU0:ASR9k-FlowSpec-Interop#sh flowspec ipv6 nlri

AFI: IPv6
 NLRI (Hex dump) :       0x018000abcd0000000000000000000000000001028000abcd0000000000
 0000000000000000020303064547034945500355455a035f4569036ec57305030145050307450b030d45
 1203144519031bc51f06032145250327452b032d45320335453a033cc5410781230881370980f00a0378
 45820387458c039145a003a545c803cdc5e10b0301450a030b45140316451e032045280334c53c0c8004
 0d0116014d010b01218159
  Actions       :Traffic-rate: 9600 bps DSCP: 45  (bgp.1)
  
RP/0/RSP0/CPU0:ASR9k-FlowSpec-Interop#

 			 ]]></artwork>
         </figure>
		 </section>
   
     </section>

     <section anchor="IANA" title="IANA Considerations">

         <t>This document makes no request of IANA.
         </t>

         <t>Note to RFC Editor: The IANA has requested that this section remain
		 in the document upon publication as an RFC.  This note to the RFC 
		 Editor, however, may be removed.
         </t>

		 </section>

     <section anchor="Security" title="Security Considerations">
         <t>No new security issues are introduced to the BGP  defined in 
         Dissemination of Flow Specification Rules for IPv6 
	     <xref target="I-D.ietf-idr-flow-spec-v6"/>.
	     </t>
     </section>

    <section anchor="Privacy" title="Privacy Considerations">
         <t>No new privacy issues are introduced to the BGP  defined in 
	     Dissemination of Flow Specification Rules for IPv6 
	     <xref target="I-D.ietf-idr-flow-spec-v6"/>.
		 </t>
    </section>

    <section anchor="Acknowledgements" title="Acknowledgements">
         <t>The authors would like to thank Hyojeong Kim, Bertrand Duvivier,  R. Divya,
			 Ashutosh Grewal and Adam Simpson.
	     </t>
    </section>

    <section anchor="log" title="Change Log">
         <t><list style="hanging">
         <t hangText="Initial Version:">8 October 2014</t>
		 <t hangText="-01 Version:">20 May 2015</t>
	     </list></t>
    </section>

  </middle>

  <back>

     <references title="Normative References">
         <?rfc include="reference.I-D.ietf-idr-flow-spec-v6"?>
         <?rfc include="reference.RFC.2119"?>
     </references>

     <references title="Informative References">
         <?rfc include="reference.RFC.4271"?>
	 </references>

  </back>

</rfc>
